<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Viewer simples de Radiologia</title>

  <!-- ESTILO (APARÊNCIA) -->
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    h1 {
      margin-top: 0;
    }

    .stack-viewer {
      position: relative;
      width: 100%;
      max-width: 512px;        /* largura máxima do viewer */
      aspect-ratio: 1 / 1;     /* mantém quadrado */
      margin: 1rem 0;
      overflow: hidden;
      border: 2px solid #555;
      border-radius: 8px;
      background: #000;
      cursor: ns-resize;       /* cursor de arrastar pra cima/baixo */

      /* impede seleção de texto / arrasto estranho */
      user-select: none;
      -webkit-user-select: none;
    }

    .stack-viewer img {
      width: 100%;
      height: 100%;
      object-fit: contain;     /* encaixa a imagem sem distorcer */
      -webkit-user-drag: none; /* desliga arrastar nativo da imagem (Chrome/Safari) */
    }

    .stack-viewer .info {
      position: absolute;
      left: 8px;
      bottom: 8px;
      padding: 4px 8px;
      font-size: 12px;
      color: #fff;
      background: rgba(0,0,0,0.5);
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Visualizador de Cortes</h1>
  <p>
    Use a rodinha do mouse ou clique e arraste <strong>para cima e para baixo</strong> em cima da imagem.
  </p>

  <!-- AQUI FICA O VIEWER -->
  <div
    class="stack-viewer"
    data-prefix="imagens/slice"
    data-count="9"
    data-padding="2"
    data-ext="png">
  </div>

  <!-- CÓDIGO JAVASCRIPT -->
  <script>
    // Função que monta o viewer dentro do container
    function initStackViewer(container) {
      // Lê as informações da div (data-*)
      const prefix  = container.dataset.prefix;       // ex: "imagens/slice"
      const count   = parseInt(container.dataset.count, 10); // quantos cortes
      const padding = parseInt(container.dataset.padding || "2", 10); // zeros
      const ext     = container.dataset.ext || "png"; // extensão

      // Monta a lista de arquivos de imagem
      const slices = [];
      for (let i = 1; i <= count; i++) {
        const num = String(i).padStart(padding, "0"); // 1 → "01"
        slices.push(prefix + num + "." + ext);
      }

      let currentIndex = 0;

      // Cria os elementos internos
      const img  = document.createElement("img");
      const info = document.createElement("div");
      info.className = "info";

      // MUITO IMPORTANTE: desliga o arrasto nativo da imagem
      img.draggable = false;

      container.appendChild(img);
      container.appendChild(info);

      // Função que troca o corte mostrado
      function showSlice(index) {
        if (index < 0) index = 0;
        if (index >= slices.length) index = slices.length - 1;
        currentIndex = index;
        img.src = slices[currentIndex];
        info.textContent = "Corte " + (currentIndex + 1) + " / " + slices.length;
      }

      // Scroll do mouse (rodinha)
      container.addEventListener("wheel", function(e) {
        e.preventDefault();
        if (e.deltaY > 0) {
          showSlice(currentIndex + 1); // desce → próximo
        } else {
          showSlice(currentIndex - 1); // sobe → anterior
        }
      }, { passive: false });

      // Arrastar pra cima/baixo
      let isDragging = false;
      let startY = 0;

      container.addEventListener("mousedown", function(e) {
        e.preventDefault();        // evita o drag padrão
        isDragging = true;
        startY = e.clientY;
      });

      window.addEventListener("mouseup", function() {
        isDragging = false;
      });

      // Agora escutamos movimento na janela inteira,
      // não só dentro da div
      window.addEventListener("mousemove", function(e) {
        if (!isDragging) return;
        e.preventDefault();        // evita comportamento estranho

        const dy = e.clientY - startY;
        const step = 10; // quantos pixels para mudar de corte
        if (Math.abs(dy) >= step) {
          const direction = dy > 0 ? 1 : -1; // arrastou pra baixo ou pra cima
          showSlice(currentIndex + direction);
          startY = e.clientY;
        }
      });

      // Mostra o primeiro corte
      showSlice(0);
    }

    // Quando a página terminar de carregar, inicia todos os viewers
    document.addEventListener("DOMContentLoaded", function() {
      const viewers = document.querySelectorAll(".stack-viewer");
      viewers.forEach(initStackViewer);
    });
  </script>
</body>
</html>

